/* oauth-ng - v0.1.1-alpha - 2014-05-21 */
"use strict";var app=angular.module("oauth",["oauth.directive","oauth.accessToken","oauth.endpoint","oauth.profile","oauth.interceptor"]);angular.module("oauth").config(["$locationProvider","$httpProvider",function(a,b){a.html5Mode(!0).hashPrefix("!"),b.interceptors.push("OAuthInterceptor")}]);var directives=angular.module("oauth.directive",[]);directives.directive("oauth",["AccessToken","Endpoint","Profile","$location","$rootScope","$compile","$http","$templateCache",function(a,b,c,d,e,f,g,h){var i={restrict:"AE",replace:!0,scope:{site:"@",clientId:"@",redirectUri:"@",scope:"@",profileUri:"@",template:"@"}};return i.link=function(d,i){d.show="none",d.$watch("client",function(){j(),k(),b.set(d),a.set(d),l(d),m()});var j=function(){d.authorizePath=d.authorizePath||"/oauth/authorize",d.tokenPath=d.tokenPath||"/oauth/token",d.template=d.template||"bower_components/oauth-ng/dist/views/templates/default.html"},k=function(){g.get(d.template,{cache:h}).success(function(a){i.html(a),f(i.contents())(d)})},l=function(b){var d=a.get();d&&d.access_token&&b.profileUri&&c.get(b.profileUri).success(function(a){b.profile=a})},m=function(b){var b=a.get();return b?b.access_token?n():b.error?p():void 0:o()};d.login=function(){b.redirect()},d.logout=function(){a.destroy(d),o()};var n=function(){e.$broadcast("oauth:success",a.get()),d.show="logged-in"},o=function(){e.$broadcast("oauth:logout"),d.show="logged-out"},p=function(){d.show="denied",e.$broadcast("oauth:denied")};d.$on("oauth:template:update",function(a,b){d.template=b,k(d)})},i}]);var service=angular.module("oauth.interceptor",[]);service.factory("OAuthInterceptor",["$rootScope","$q","$sessionStorage",function(a,b,c){var d={};d.request=function(b){var d=c.token;return d&&(b.headers.Authorization="Bearer "+d.access_token),d&&e(d)&&a.$broadcast("oauth:expired",d),b};var e=function(a){return a&&a.expires_at&&new Date(a.expires_at)<new Date};return d}]);var service=angular.module("oauth.accessToken",["ngStorage"]);service.factory("AccessToken",["$rootScope","$location","$http","$sessionStorage",function(a,b,c,d){var e={},f=null;e.get=function(){return f},e.set=function(){return g(),i(),f},e.destroy=function(){return delete d.token,f=null},e.expired=function(){return f&&f.expires_at&&f.expires_at<new Date};var g=function(){var a=h(b.hash());a&&(m(),k(a))},h=function(a){for(var b=a.split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),f=e[0],g=e[1];c[f]=g}return c.access_token||c.error?c:void 0},i=function(){if(d.token){var a=d.token;k(a)}},j=function(){d.token=f},k=function(a){return f=f||{},angular.extend(f,a),l(),j(),f},l=function(){if(f){var a=new Date;a.setSeconds(a.getSeconds()+parseInt(f.expires_in)-60),f.expires_at=a}},m=function(){b.hash("")};return e}]);var client=angular.module("oauth.endpoint",[]);client.factory("Endpoint",["AccessToken","$location",function(a,b){var c,d={};return d.set=function(a){return c=a.site+a.authorizePath+"?response_type=token&client_id="+a.clientId+"&redirect_uri="+a.redirectUri+"&scope="+a.scope+"&state="+b.url()},d.get=function(){return c},d.redirect=function(){window.location.replace(c)},d}]);var client=angular.module("oauth.profile",[]);client.factory("Profile",["$http",function(a){var b={};return b.get=function(b){return a.get(b)},b}]);